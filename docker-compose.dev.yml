# Development environment with hot reload
# Usage: docker compose -f docker-compose.yml -f docker-compose.dev.yml up

name: silveredge-dev

services:
  mongodb:
    volumes:
      - mongodb_data:/data/db
    ports:
      - "27017:27017"

  minio:
    volumes:
      - minio_data:/data
    ports:
      - "9000:9000"
      - "9001:9001"

  backend:
    build:
      context: .
      dockerfile: backend/Dockerfile.dev
    volumes:
      - ./backend/src:/app/backend/src:delegated
      - ./packages/shared/src:/app/packages/shared/src:delegated
      - ./backend/package.json:/app/backend/package.json:ro
      - ./backend/tsconfig.json:/app/backend/tsconfig.json:ro
      - backend_node_modules:/app/node_modules
    ports:
      - "3000:3000"
    environment:
      NODE_ENV: development

  admin-frontend:
    build:
      context: .
      dockerfile: apps/admin/Dockerfile.dev
    volumes:
      - ./apps/admin/src:/app/apps/admin/src:delegated
      - ./apps/admin/public:/app/apps/admin/public:delegated
      - ./apps/admin/index.html:/app/apps/admin/index.html:ro
      - ./apps/admin/vite.config.ts:/app/apps/admin/vite.config.ts:ro
      - ./apps/admin/tsconfig.json:/app/apps/admin/tsconfig.json:ro
      - ./packages/shared/src:/app/packages/shared/src:delegated
      - admin_node_modules:/app/node_modules
    ports:
      - "5173:5173"
    environment:
      VITE_API_URL: http://localhost:8080/api

  student-frontend:
    build:
      context: .
      dockerfile: apps/student/Dockerfile.dev
    volumes:
      - ./apps/student/src:/app/apps/student/src:delegated
      - ./apps/student/public:/app/apps/student/public:delegated
      - ./apps/student/index.html:/app/apps/student/index.html:ro
      - ./apps/student/vite.config.ts:/app/apps/student/vite.config.ts:ro
      - ./apps/student/tsconfig.json:/app/apps/student/tsconfig.json:ro
      - ./packages/shared/src:/app/packages/shared/src:delegated
      - student_node_modules:/app/node_modules
    ports:
      - "5174:5174"
    environment:
      VITE_API_URL: http://localhost:8080/api

  nginx:
    volumes:
      - ./nginx/nginx.dev.conf:/etc/nginx/nginx.conf:ro
    ports:
      - "8080:80"

volumes:
  mongodb_data:
  minio_data:
  backend_node_modules:
  admin_node_modules:
  student_node_modules:

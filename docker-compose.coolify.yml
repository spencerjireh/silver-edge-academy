# Coolify deployment configuration
# Usage: Set compose files to "docker-compose.yml;docker-compose.coolify.yml" in Coolify
#
# Coolify Setup:
# 1. Coolify automatically creates a network for all services in this stack
# 2. Configure domain in Coolify UI - it handles Traefik labels and TLS automatically
# 3. Set the domain to point to the nginx service (port 80)
# 4. Configure environment variables in Coolify UI

name: silveredge-coolify

services:
  mongodb:
    volumes:
      - mongodb_data:/data/db
    restart: always
    labels:
      - "coolify.managed=false"
    # Internal service - no public access needed

  minio:
    volumes:
      - minio_data:/data
    restart: always
    labels:
      - "coolify.managed=false"
    # Internal service - no public access needed

  backend:
    build:
      context: .
      dockerfile: backend/Dockerfile
    restart: always
    environment:
      NODE_ENV: production
    labels:
      - "coolify.managed=false"
    # Internal service - accessed via nginx reverse proxy

  admin-frontend:
    build:
      context: .
      dockerfile: apps/admin/Dockerfile
    restart: always
    labels:
      - "coolify.managed=false"
    # Internal service - served via nginx reverse proxy

  student-frontend:
    build:
      context: .
      dockerfile: apps/student/Dockerfile
    restart: always
    labels:
      - "coolify.managed=false"
    # Internal service - served via nginx reverse proxy

  nginx:
    volumes:
      - ./nginx/nginx.prod.conf:/etc/nginx/nginx.conf:ro
    restart: always
    ports:
      - "80:80"
    # This is the ONLY service that should have a domain configured in Coolify
    # Configure domain in Coolify UI for this service

volumes:
  mongodb_data:
  minio_data:
